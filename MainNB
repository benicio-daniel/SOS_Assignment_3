{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "b5102982",
   "metadata": {},
   "source": [
    "# Esatblishing Onthologies"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "31f6d272",
   "metadata": {},
   "outputs": [],
   "source": [
    "from rdflib import Graph, Namespace, RDF, RDFS, Literal, URIRef\n",
    "import uuid\n",
    "from datetime import datetime, timezone\n",
    "from starvers.starvers import TripleStoreEngine\n",
    "import arff"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "5c0e6cb0",
   "metadata": {},
   "source": [
    "**!!!IMPORTANT!!!**\n",
    "\n",
    "Everytime you work on this notebook, enter your student ID in the `executed_by` variable so that the cell executions are accredited to you."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f3df3193",
   "metadata": {},
   "outputs": [],
   "source": [
    "#Ben\n",
    "executed_by ='stud-id_12038369'\n",
    "#Philipp\n",
    "# executed_by ='stud-id_12132552'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3eb2b5aa",
   "metadata": {},
   "outputs": [],
   "source": [
    "# group id for this project\n",
    "group_id = '13'  # Replace the digits with your group id\n",
    "\n",
    "# Students working on this notebook\n",
    "student_a = 'stud-id_12038369'  # Replace the digits after \"id_\" with student A's student ID\n",
    "student_b = 'stud-id_12132552'  #philipps MA Nummer"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f18f394f",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Roles. Don't change these values.\n",
    "code_writer_role = 'code_writer'\n",
    "code_executor_role = 'code_executor'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2abfe7ea",
   "metadata": {},
   "outputs": [],
   "source": [
    "get_endpoint = \"https://starvers.ec.tuwien.ac.at/SOS2025\"\n",
    "post_endpoint = \"https://starvers.ec.tuwien.ac.at/SOS2025/statements\"\n",
    "engine = TripleStoreEngine(get_endpoint, post_endpoint, skip_connection_test=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "85dae397",
   "metadata": {},
   "outputs": [],
   "source": [
    "prefixes = {\n",
    "    'xsd': 'http://www.w3.org/2001/XMLSchema#',\n",
    "    'foaf': 'http://xmlns.com/foaf/0.1/',\n",
    "    'prov': 'http://www.w3.org/ns/prov#',\n",
    "    'sc': 'https://schema.org/',\n",
    "    'cr': 'http://mlcommons.org/croissant/',\n",
    "    'mls': 'http://www.w3.org/ns/mls#',\n",
    "    'mlso': 'http://w3id.org/mlso',\n",
    "    'siu': 'https://si-digital-framework.org/SI/units/',\n",
    "    'siq': 'https://si-digital-framework.org/SI/quantities/',\n",
    "    'qudt': 'http://qudt.org/schema/qudt/',\n",
    "    '': f'https://starvers.ec.tuwien.ac.at/ SOS2025/{group_id}/',\n",
    "}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "c01b0f93",
   "metadata": {},
   "outputs": [],
   "source": [
    "def now() -> str:\n",
    "    \"\"\"\n",
    "    Returns the current time in ISO 8601 format with UTC timezone in the following format:\n",
    "    YYYY-MM-DDTHH:MM:SS.sssZ\n",
    "    \"\"\"\n",
    "    timestamp = datetime.datetime.now(datetime.timezone.utc)\n",
    "    timestamp_formated = timestamp.strftime(\"%Y-%m-%dT%H:%M:%S.%f\")[:-3]  +\"Z\"\n",
    "\n",
    "    return timestamp_formated"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "aa4028bc",
   "metadata": {},
   "source": [
    "Register yourself in the Knowledge Graph using ProvO. Change the given name, family name and immatriculation number to reflect your own data."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "73614b84",
   "metadata": {},
   "outputs": [],
   "source": [
    "# Ontologies used: foaf, prov, IAO\n",
    "reigstration_triples_a = [\n",
    "f':{student_a} rdf:type foaf:Person .',\n",
    "f':{student_a} rdf:type prov:Agent .',\n",
    "f':{student_a} foaf:givenName \"Benicio\" .',\n",
    "f':{student_a} foaf:familyName \"Daniel\" .',\n",
    "f':{student_a} <http://vivoweb.org/ontology/core#identifier> :{student_a} .',\n",
    "f':{student_a} rdf:type <http://purl.obolibrary.org/obo/IAO_0000578> .',\n",
    "f':{student_a} <http://www.w3.org/2000/01/rdf-schema#label> \"Immatriculation number\" .',\n",
    "f':{student_a} <http://purl.obolibrary.org/obo/IAO_0000219> \"12038369\"^^xsd:string .',\n",
    "]\n",
    "#TODO Philipp MA\n",
    "reigstration_triples_b = [\n",
    "f':{student_b} rdf:type foaf:Person .',\n",
    "f':{student_b} rdf:type prov:Agent .',\n",
    "f':{student_b} foaf:givenName \"Philipp\" .',\n",
    "f':{student_b} foaf:familyName \"Schott\" .',\n",
    "f':{student_b} <http://vivoweb.org/ontology/core#identifier> :{student_b} .',\n",
    "f':{student_b} rdf:type <http://purl.obolibrary.org/obo/IAO_0000578> .',\n",
    "f':{student_b} <http://www.w3.org/2000/01/rdf-schema#label> \"Immatriculation number\" .',\n",
    "f':{student_b} <http://purl.obolibrary.org/obo/IAO_0000219> \"12132552\"^^xsd:string .',\n",
    "]\n",
    "\n",
    "role_triples = [\n",
    "    f':{code_writer_role} rdf:type prov:Role .',\n",
    "    f':{code_executor_role} rdf:type prov:Role .',\n",
    "]\n",
    "\n",
    "\n",
    "engine.insert(reigstration_triples_a, prefixes=prefixes)\n",
    "engine.insert(reigstration_triples_b, prefixes=prefixes)\n",
    "engine.insert(role_triples, prefixes=prefixes)"
   ]
  },
  {
   "cell_type": "markdown",
   "id": "a44cd48f",
   "metadata": {},
   "source": [
    "**What not do do**\n",
    "\n",
    "Do not use [blank nodes](https://www.w3.org/wiki/BlankNodes).\n",
    "\n",
    "PROV-O uses blank nodes to connect multiple elements with each other.\n",
    "Such blank nodes (such as _:association) should not be used.\n",
    "Instead, assign a fixed node ID such as\n",
    ":5119fcd7-b571-41e0-9464-a37c7be0f574 by generating them outside of the\n",
    "notebook.\n",
    "We suggest that, for each setting where such a blank node is needed to\n",
    "connect multiple elements, you create a unique hash (using uuid.uuid4())\n",
    "and keep this as hard-coded identifier for the blank node. The template\n",
    "notebook contains examples of this. Do *not* use these provided values,\n",
    "as otherwise, your provenance documentations will all be connected via\n",
    "these identifiers!\n",
    "Also, do not generate them dynamically in every cell execution, e.g. by\n",
    "using uuid.uuid4() in a cell. This would generate many new linking nodes\n",
    "for connecting the same elements.\n",
    "Compute one for each node (cell) where you need them and make sure to\n",
    "use the same one on each re-execution of the notebook."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "id": "5b9fe5dd",
   "metadata": {},
   "outputs": [],
   "source": [
    "ASSOC_RUN1_EXEC = '0ff89396-5f86-4497-9b5e-26e5aba9ca55'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "f3bc911a",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "DATASET_UUID = d60ba562-ba83-4f5b-8951-6918e9e43539\n",
      "DIST_UUID = 51207666-9e42-4a62-82e2-cef6b56c70e8\n",
      "RECORDSET_UUID = 0ca825e0-8119-4803-bd95-d8e4f89ccb28\n"
     ]
    }
   ],
   "source": [
    "\n",
    "#DATASET_UUID   = str(uuid.uuid4())\n",
    "#DIST_UUID      = str(uuid.uuid4())\n",
    "#RECORDSET_UUID = str(uuid.uuid4())\n",
    "\n",
    "#print(\"DATASET_UUID =\", DATASET_UUID)\n",
    "#print(\"DIST_UUID =\", DIST_UUID)\n",
    "#print(\"RECORDSET_UUID =\", RECORDSET_UUID)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "b0919b60",
   "metadata": {},
   "outputs": [],
   "source": [
    "# --- 2. Hard-code the UUIDs (example values — replace with yours) ---\n",
    "DATASET_UUID = \"d60ba562-ba83-4f5b-8951-6918e9e43539\"\n",
    "DIST_UUID = \"51207666-9e42-4a62-82e2-cef6b56c70e8\"\n",
    "RECORDSET_UUID = \"0ca825e0-8119-4803-bd95-d8e4f89ccb28\"\n",
    "\n",
    "DATASET_ID   = f\"dataset-{DATASET_UUID}\"\n",
    "DIST_ID      = f\"dist-{DIST_UUID}\"\n",
    "RECORDSET_ID = f\"rs-{RECORDSET_UUID}\"\n",
    "\n",
    "dataset_triples = [\n",
    "    f':{DATASET_ID} rdf:type sc:Dataset .',\n",
    "    f':{DATASET_ID} sc:name \"YOUR DATASET NAME\"^^xsd:string .',\n",
    "    f':{DATASET_ID} sc:description \"1–3 sentences describing what the dataset contains + target label.\"^^xsd:string .',\n",
    "    f':{DATASET_ID} sc:license \"https://…license-url…\"^^xsd:anyURI .',\n",
    "    f':{DATASET_ID} sc:url \"https://…source-or-openml-url…\"^^xsd:anyURI .',\n",
    "    f':{DATASET_ID} sc:keywords \"OpenML, SOM, classification\"^^xsd:string .',\n",
    "\n",
    "    # Distribution (where the data can be fetched)\n",
    "    f':{DATASET_ID} sc:distribution :{DIST_ID} .',\n",
    "    f':{DIST_ID} rdf:type sc:DataDownload .',\n",
    "    f':{DIST_ID} sc:contentUrl \"https://…direct-download-or-github-raw…\"^^xsd:anyURI .',\n",
    "    f':{DIST_ID} sc:encodingFormat \"text/csv\"^^xsd:string .',\n",
    "]\n",
    "\n",
    "# Optional Croissant structure (lightweight)\n",
    "croissant_triples = [\n",
    "    f':{DATASET_ID} cr:recordSet :{RECORDSET_ID} .',\n",
    "    f':{RECORDSET_ID} rdf:type cr:RecordSet .',\n",
    "    f':{RECORDSET_ID} cr:description \"Each record corresponds to one instance/row in the CSV.\"^^xsd:string .',\n",
    "    # Add fields (columns) similarly if you want (cr:Field), one per feature/label.\n",
    "]\n",
    "\n",
    "engine.insert(dataset_triples + croissant_triples, prefixes=prefixes)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "871890d3",
   "metadata": {},
   "outputs": [
    {
     "ename": "AttributeError",
     "evalue": "'generator' object has no attribute 'dtype'",
     "output_type": "error",
     "traceback": [
      "\u001b[31m---------------------------------------------------------------------------\u001b[39m",
      "\u001b[31mAttributeError\u001b[39m                            Traceback (most recent call last)",
      "\u001b[36mCell\u001b[39m\u001b[36m \u001b[39m\u001b[32mIn[12]\u001b[39m\u001b[32m, line 2\u001b[39m\n\u001b[32m      1\u001b[39m dataset = arff.load(\u001b[38;5;28mopen\u001b[39m(\u001b[33m'\u001b[39m\u001b[33mfars.arff\u001b[39m\u001b[33m'\u001b[39m, \u001b[33m'\u001b[39m\u001b[33mrb\u001b[39m\u001b[33m'\u001b[39m))\n\u001b[32m----> \u001b[39m\u001b[32m2\u001b[39m \u001b[43mdataset\u001b[49m\u001b[43m.\u001b[49m\u001b[43mdtype\u001b[49m\n",
      "\u001b[31mAttributeError\u001b[39m: 'generator' object has no attribute 'dtype'"
     ]
    }
   ],
   "source": [
    "dataset = arff.load(open('fars.arff', 'rb'))\n",
    "dataset.dtype"
   ]
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "sos_venv",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
